üöÄ Initializing HolisticOS Multi-Agent System...
2025-08-15 15:40:29 [info     ] Agent initialized              agent_id=holistic_orchestrator agent_type=orchestrator system_prompt_length=5320       
2025-08-15 15:40:29 [info     ] Agent initialized              agent_id=memory_management_agent agent_type=memory_management system_prompt_length=7499
INFO:services.agents.memory.main:Initialized HolisticMemoryAgent with system prompt length: 7499
2025-08-15 15:40:29 [info     ] Agent initialized              agent_id=insights_generation_agent agent_type=insights_generation system_prompt_length=11002
INFO:services.agents.insights.main:Initialized HolisticInsightsAgent with system prompt length: 11002
2025-08-15 15:40:29 [info     ] Agent initialized              agent_id=adaptation_engine_agent agent_type=adaptation_engine system_prompt_length=13771
INFO:services.agents.adaptation.main:Initialized HolisticAdaptationEngine with system prompt length: 13771
2025-08-15 15:40:29 [info     ] Direct agent instances created successfully
 agent_id=holistic_orchestrator agent_type=orchestrator
2025-08-15 15:40:29 [info     ] HolisticOS Multi-Agent Orchestrator initialized with 6 agents agent_id=holistic_orchestrator agent_type=orchestrator  
2025-08-15 15:40:29 [info     ] Agent initialized              agent_id=memory_management_agent agent_type=memory_management system_prompt_length=7499
INFO:services.agents.memory.main:Initialized HolisticMemoryAgent with system prompt length: 7499
2025-08-15 15:40:29 [info     ] Agent initialized              agent_id=insights_generation_agent agent_type=insights_generation system_prompt_length=11002
INFO:services.agents.insights.main:Initialized HolisticInsightsAgent with system prompt length: 11002
2025-08-15 15:40:29 [info     ] Agent initialized              agent_id=adaptation_engine_agent agent_type=adaptation_engine system_prompt_length=13771
INFO:services.agents.adaptation.main:Initialized HolisticAdaptationEngine with system prompt length: 13771
‚úÖ Using on-demand behavior analysis (automatic scheduler disabled)        
‚úÖ All agents initialized successfully
INFO:     Application startup complete.
INFO:     127.0.0.1:62333 - "GET / HTTP/1.1" 200 OK
üîÑ [ROUTINE_GENERATE] Processing routine request for user 35pDPUIf...
üìû [ROUTINE_GENERATE] Getting shared behavior analysis...
INFO:services.health_data_client:[API_CLIENT] Initialized for https://hos-fapi-hm-sahha.onrender.com
INFO:services.ondemand_analysis_service:[ONDEMAND] Initialized on-demand analysis service
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Connected to Supabase directly
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=last_analysis_at&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] No previous analysis found for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:services.api_gateway.openai_main:[SHARED_ANALYSIS] 35pDPUIf... Decision: fresh_analysis, Data: 0/50
INFO:services.api_gateway.openai_main:[SHARED_ANALYSIS] 35pDPUIf... Running fresh analysis
INFO:services.health_data_client:[API_CLIENT] Initialized for https://hos-fapi-hm-sahha.onrender.com
[üîÑ MEMORY_SERVICE] Creating new adapter and connecting...
[üîç] Attempting Supabase connection...
[üîç] URL: https://ijcckqnqruwvqqbkiubb.s...
[üîç] Key: Present
[‚úÖ] Connected to Supabase successfully - client type: <class 'supabase._sync.client.SyncClient'>
[‚úÖ MEMORY_SERVICE] Connected to Supabase successfully
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_analysis_results?select=id%2Cuser_id%2Canalysis_type%2Canalysis_result%2Carchetype%2Ccreated_at&user_id=eq.%2735pDPUIfAoRl2Y700&order=created_at.asc "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Connected to Supabase directly
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=last_analysis_at&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] No previous analysis found for 35pDPUIfAoRl2Y700bFkxPKYjjf2
üÜï ANALYSIS_MODE: New user - initial analysis (7 days data)
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_longterm_memory?select=user_id%2Cmemory_category%2Cmemory_data%2Cconfidence_score%2Ccreated_at%2Clast_updated&user_id=eq.%2735pDPUIfAoRl2Y700&order=confidence_score.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_shortterm_memory?select=user_id%2Cmemory_category%2Ccontent%2Cconfidence_score%2Ccreated_at%2Cexpires_at&user_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&order=created_at.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_meta_memory?select=adaptation_patterns%2Clearning_velocity%2Csuccess_predictors%2Cfailure_patterns%2Cagent_effectiveness%2Cconfidence_level%2Clast_updated&user_id=eq.%2735pDPUIfAoRl2Y700&order=confidence_level.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_analysis_results?select=id%2Cuser_id%2Canalysis_type%2Canalysis_result%2Carchetype%2Ccreated_at&user_id=eq.%2735pDPUIfAoRl2Y700&order=created_at.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_working_memory "HTTP/2 201 Created"
üìã MEMORY_CONTEXT: initial mode, 7 days, 2 focus areas
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Connected to Supabase directly
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=last_analysis_at&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] No previous analysis found for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:services.user_data_service:[ANALYSIS_DATA] First analysis for 35pDPUIfAoRl2Y700bFkxPKYjjf2, fetching 7 days baseline
üìä INCREMENTAL_SYNC: No previous analysis found - fetching 7 days baseline 
INFO:httpx:HTTP Request: PATCH https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Updated analysis time for 35pDPUIfAoRl2Y700bFkxPKYjjf2: 2025-08-15T19:41:08.895934+00:00       
INFO:services.user_data_service:[ANALYSIS_DATA] Updated last_analysis_at to: 2025-08-15T19:41:08.895934+00:00
INFO:services.user_data_service:[USER_HEALTH_DATA] Starting fetch for user 35pDPUIfAoRl2Y700bFkxPKYjjf2, 7 days
INFO:services.user_data_service:[API_FIRST] Attempting API fetch for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:services.health_data_client:[API_REQUEST] /api/v1/sahha/scores with params: {'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'start_date': '2025-08-08', 'end_date': '2025-08-15', 'limit': 1000}
INFO:services.health_data_client:[API_REQUEST] /api/v1/sahha/biomarkers with params: {'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'start_date': '2025-08-08', 'end_date': '2025-08-15', 'limit': 1000}
INFO:services.health_data_client:[API_REQUEST] /api/v1/sahha/archetypes with params: {'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'limit': 100}        
INFO:httpx:HTTP Request: GET https://hos-fapi-hm-sahha.onrender.com/api/v1/sahha/scores?user_id=35pDPUIfAoRl2Y700bFkxPKYjjf2&start_date=2025-08-08&end_date=2025-08-15&limit=1000 "HTTP/1.1 200 OK"
INFO:services.health_data_client:[API_SUCCESS] /api/v1/sahha/scores: 10 records in 1710ms
INFO:httpx:HTTP Request: GET https://hos-fapi-hm-sahha.onrender.com/api/v1/sahha/archetypes?user_id=35pDPUIfAoRl2Y700bFkxPKYjjf2&limit=100 "HTTP/1.1 200 OK"
INFO:services.health_data_client:[API_SUCCESS] /api/v1/sahha/archetypes: 100 records in 1490ms
INFO:httpx:HTTP Request: GET https://hos-fapi-hm-sahha.onrender.com/api/v1/sahha/biomarkers?user_id=35pDPUIfAoRl2Y700bFkxPKYjjf2&start_date=2025-08-08&end_date=2025-08-15&limit=1000 "HTTP/1.1 200 OK"
INFO:services.health_data_client:[API_SUCCESS] /api/v1/sahha/biomarkers: 41 records in 2137ms
INFO:services.user_data_service:[API_SUCCESS] Using API data: 10 scores, 41 biomarkers
INFO:services.user_data_service:[USER_HEALTH_DATA] API completed for 35pDPUIfAoRl2Y700bFkxPKYjjf2 in 2.44s
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=analysis_metadata&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: PATCH https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Incremented analysis count for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:services.user_data_service:[ANALYSIS_DATA] Initial analysis completed in 4.32s
INFO:services.user_data_service:[ANALYSIS_DATA] Latest data found: 2025-08-14T14:50:08.695460+00:00
INFO:services.agents.memory.enhanced_memory_prompts:Enhancing behavior_analysis prompt with memory context for user 35pDPUIf...
[üîÑ MEMORY_SERVICE] Creating new adapter and connecting...
[üîç] Attempting Supabase connection...
[üîç] URL: https://ijcckqnqruwvqqbkiubb.s...
[üîç] Key: Present
[‚úÖ] Connected to Supabase successfully - client type: <class 'supabase._sync.client.SyncClient'>
[‚úÖ MEMORY_SERVICE] Connected to Supabase successfully
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_longterm_memory?select=user_id%2Cmemory_category%2Cmemory_data%2Cconfidence_score%2Ccreated_at%2Clast_updated&user_id=eq.%2735pDPUIfAoRl2Y700&order=confidence_score.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_shortterm_memory?select=user_id%2Cmemory_category%2Ccontent%2Cconfidence_score%2Ccreated_at%2Cexpires_at&user_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&order=created_at.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_meta_memory?select=adaptation_patterns%2Clearning_velocity%2Csuccess_predictors%2Cfailure_patterns%2Cagent_effectiveness%2Cconfidence_level%2Clast_updated&user_id=eq.%2735pDPUIfAoRl2Y700&order=confidence_level.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_working_memory?select=user_id%2Csession_id%2Cagent_id%2Cmemory_type%2Ccontent%2Cpriority%2Ccreated_at%2Cexpires_at&user_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&is_active=eq.true&order=created_at.asc "HTTP/2 200 OK"    
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
   üìã Agent handoff logged: behavior_analysis ‚Üí logs/agent_handoffs/1_behavior_analysis_20250815_154147.txt
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Storing insights from behavior_analysis analysis for 35pDPUIfAoRl2Y700bFkxPKYjjf2       
üîç MEMORY DEBUG: Starting store_analysis_result for behavior_analysis      
üîç MEMORY DEBUG: DB connection established: <class 'shared_libs.supabase_client.adapter.SupabaseAsyncPGAdapter'>
üîç MEMORY DEBUG: Executing SQL insert...
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_analysis_results "HTTP/2 201 Created"
üîç MEMORY DEBUG: SQL result: {'id': 'd1e1fafe-8259-4c4b-aabc-374ad19de98a', 'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'analysis_type': 'behavior_analysis', 'archetype': 'Foundation Builder', 'analysis_result': {'model_used': 'o3', 'primary_goal': {'goal': 'Create a stable daily routine that keeps sleep quality high while progressively increasing light-to-moderate physical activity.', 'timeline': 'Next 8‚Äì12 weeks', 'success_metrics': '1) Maintain average Sleep Metrics ‚â• 0.80; 2) Raise Activity Metrics from 0.54 ‚Üí ‚â• 0.65; 3) Improve Mental_Wellbeing Metrics from 0.74 ‚Üí ‚â• 0.80.'}, 'analysis_type': 'comprehensive_behavior', 'data_insights': '‚Ä¢ Sleep: Consistently strong across latency, efficiency, and duration; only one minor interruption recorded.\n‚Ä¢ Activity: Two tracked sessions suggest sporadic rather than daily movement; average intensity appears low-to-moderate.\n‚Ä¢ Readiness: 0.77 indicates the body is recovering well‚Äîcapacity exists to add light activity without compromising recovery.\n‚Ä¢ Respiratory Rate single reading lies within normal range and does not show stress dysregulation.\nOverall: Sleep foundation is solid. Leverage this stability to incrementally raise daytime movement, which is currently the main growth area.', 'readiness_level': 'Medium', 'recommendations': ['Keep capturing sleep data daily; this is your strongest current habit.', 'Add step count or simple activity tracking to every day, aiming for +1,000 steps above current baseline in Week 1.', 'Schedule one 5-minute reflection each evening to rate mood (0-10 scale) and note one positive action; this will strengthen Mental_Wellbeing tracking.', 'Set a fixed ‚Äòtech-off‚Äô time 30 minutes before bed to protect sleep latency (now 1 measurement but worth preserving).', 'Review progress each Sunday; if you achieved ‚â• 5 days of your planned walk, add 5 minutes to the walk the following week.'], 'behavioral_signature': {'signature': 'New Foundation Builder who shows high reliability in data capture (100 % coverage) and good sleep hygiene (Sleep Metrics = 0.81, high trend). Activity engagement is modest (Activity Metrics = 0.54, medium trend) and mental-wellbeing is moderately positive (0.74). Pattern suggests the user is willing to track and reflect but is still establishing core daytime movement and stress-management habits.', 'confidence': 0.55}, 'personalized_strategy': {'habit_integration': 'Anchor a 15-minute brisk walk immediately after your most predictable daily event (e.g., after lunch) and extend by 5 minutes each week until 30 minutes is comfortable. Keep bedtime and wake-time within a 30-minute window to preserve existing sleep strength.', 'barrier_mitigation': '‚Ä¢ Prevent overwhelm: limit new goals to one habit per fortnight.\n‚Ä¢ Environment: lay out walking shoes near your desk as a visual cue.\n‚Ä¢ Time scarcity: if a full walk is impossible, perform two 7-minute micro-walks.', 'motivation_drivers': 'Early visible wins, simple structure, and clear cause-and-effect feedback (e.g., ‚ÄòWhen I walk 15 min at lunch I sleep better‚Äô).'}, 'sophistication_assessment': {'score': 38, 'category': 'Beginner', 'justification': 'First week of tracking, limited metric variety (mainly sleep + basic activity), no prior longitudinal patterns, and archetype is Foundation Builder‚Äîindicating early-stage habit formation rather than advanced self-optimization.'}}, 'input_summary': {'source': 'memory_service', 'data_quality': 'excellent'}, 'agent_id': 'memory_service', 'analysis_version': '1.0', 'system_prompt_version': None, 'confidence_score': 0, 'completeness_score': 0, 'processing_time_ms': None, 'created_at': '2025-08-15T19:41:47.728288+00:00', 'analysis_date': '2025-08-15', 'user_rating': None, 'user_feedback': None, 'implementation_success': None, 'follow_up_date': None, 'analysis_hash': 'eda796b604e811626583b3d51fc6094d', 'data_source_hash': None, 'is_duplicate': False, 'original_analysis_id': None}
üìä MEMORY: Stored behavior_analysis analysis for user 35pDPUIf... ID: d1e1fafe-8259-4c4b-aabc-374ad19de98a
[üîÑ INSIGHTS_SERVICE] Creating new adapter and connecting...
[üîç] Attempting Supabase connection...
[üîç] URL: https://ijcckqnqruwvqqbkiubb.s...
[üîç] Key: Present
[‚úÖ] Connected to Supabase successfully - client type: <class 'supabase._sync.client.SyncClient'>
[‚úÖ INSIGHTS_SERVICE] Connected to Supabase successfully
üîç [DEBUG] About to insert insight with params:
   user_id: 35pDPUIfAoRl2Y700bFkxPKYjjf2
   insight_type: behavioral
   title: Key Recommendation #1...
   content: Keep capturing sleep data daily; this is your strongest current habit....
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_insights "HTTP/2 201 Created"
üîç [DEBUG] INSERT result: {'id': '258d67e5-dda9-4faf-bdcf-6ccbc95c1773', 'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'insight_type': 'behavioral', 'source_analysis_id': None, 'source_analysis_type': None, 'archetype': 'Foundation Builder', 'insight_title': 'Key Recommendation #1', 'insight_content': 'Keep capturing sleep data daily; this is your strongest current habit.', 'priority': 5, 'actionability_score': 0.7, 'data_context': None, 'confidence_score': 0.8, 'supporting_metrics': None, 'tags': [], 'is_active': True, 'user_acknowledged': False, 'user_rating': None, 'user_feedback': None, 'created_at': '2025-08-15T19:41:48.906967+00:00', 'updated_at': '2025-08-15T19:41:48.906967+00:00', 'expires_at': '2025-08-22T19:41:48.062761+00:00', 'last_surfaced_at': None, 'content_hash': 'b89e03ccf5bfea19ee5ed2815398c30a', 'context_signature': 'b89e03ccf5bfea19ee5ed2815398c30a'}
‚ú® [INSIGHTS] Stored insight: Key Recommendation #1
üîç [DEBUG] About to insert insight with params:
   user_id: 35pDPUIfAoRl2Y700bFkxPKYjjf2
   insight_type: behavioral
   title: Key Recommendation #2...
   content: Add step count or simple activity tracking to every day, aiming for +1,000 steps above current basel...
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_insights "HTTP/2 201 Created"
üîç [DEBUG] INSERT result: {'id': 'e802fd0e-e801-4d5d-a63f-23cda90c746b', 'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'insight_type': 'behavioral', 'source_analysis_id': None, 'source_analysis_type': None, 'archetype': 'Foundation Builder', 'insight_title': 'Key Recommendation #2', 'insight_content': 'Add step count or simple activity tracking to every day, aiming for +1,000 steps above current baseline in Week 1.', 'priority': 5, 'actionability_score': 0.7, 'data_context': None, 'confidence_score': 0.8, 'supporting_metrics': None, 'tags': [], 'is_active': True, 'user_acknowledged': False, 'user_rating': None, 'user_feedback': None, 'created_at': '2025-08-15T19:41:49.30711+00:00', 'updated_at': '2025-08-15T19:41:49.30711+00:00', 'expires_at': '2025-08-22T19:41:48.873244+00:00', 'last_surfaced_at': None, 'content_hash': '31b3925f460ae2a78a7d4345128e8d6c', 'context_signature': '31b3925f460ae2a78a7d4345128e8d6c'}
‚ú® [INSIGHTS] Stored insight: Key Recommendation #2
üîç [DEBUG] About to insert insight with params:
   user_id: 35pDPUIfAoRl2Y700bFkxPKYjjf2
   insight_type: behavioral
   title: Key Recommendation #3...
   content: Schedule one 5-minute reflection each evening to rate mood (0-10 scale) and note one positive action...
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_insights "HTTP/2 201 Created"
üîç [DEBUG] INSERT result: {'id': '3729564e-b698-4204-b397-7c607b028171', 'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'insight_type': 'behavioral', 'source_analysis_id': None, 'source_analysis_type': None, 'archetype': 'Foundation Builder', 'insight_title': 'Key Recommendation #3', 'insight_content': 'Schedule one 5-minute reflection each evening to rate mood (0-10 scale) and note one positive action; this will strengthen Mental_Wellbeing tracking.', 'priority': 5, 'actionability_score': 0.7, 'data_context': None, 'confidence_score': 0.8, 'supporting_metrics': None, 'tags': [], 'is_active': True, 'user_acknowledged': False, 'user_rating': None, 'user_feedback': None, 'created_at': '2025-08-15T19:41:49.62397+00:00', 'updated_at': '2025-08-15T19:41:49.62397+00:00', 'expires_at': '2025-08-22T19:41:49.269391+00:00', 'last_surfaced_at': None, 'content_hash': '8ff480bf250de9770f8631d23f8376d1', 'context_signature': '8ff480bf250de9770f8631d23f8376d1'}
‚ú® [INSIGHTS] Stored insight: Key Recommendation #3
üîç [DEBUG] About to insert insight with params:
   user_id: 35pDPUIfAoRl2Y700bFkxPKYjjf2
   insight_type: behavioral
   title: Primary Health Goal...
   content: Create a stable daily routine that keeps sleep quality high while progressively increasing light-to-...
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_insights "HTTP/2 201 Created"
üîç [DEBUG] INSERT result: {'id': '87fd9f25-1492-48bf-9132-21a7964778c6', 'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'insight_type': 'behavioral', 'source_analysis_id': None, 'source_analysis_type': None, 'archetype': 'Foundation Builder', 'insight_title': 'Primary Health Goal', 'insight_content': 'Create a stable daily routine that keeps sleep quality high while progressively increasing light-to-moderate physical activity.', 'priority': 5, 'actionability_score': 0.7, 'data_context': None, 'confidence_score': 0.8, 'supporting_metrics': None, 'tags': [], 'is_active': True, 'user_acknowledged': False, 'user_rating': None, 'user_feedback': None, 'created_at': '2025-08-15T19:41:49.957019+00:00', 'updated_at': '2025-08-15T19:41:49.957019+00:00', 'expires_at': '2025-08-22T19:41:49.591092+00:00', 'last_surfaced_at': None, 'content_hash': 'ed559100d70b8fe8c117a26422fff5d8', 'context_signature': 'ed559100d70b8fe8c117a26422fff5d8'}
‚ú® [INSIGHTS] Stored insight: Primary Health Goal
INFO:services.insights_extraction_service:Extracted and stored 4 insights from behavior_analysis
‚ú® INSIGHTS: Stored 4 insights from behavior_analysis
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_shortterm_memory "HTTP/2 201 Created"
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Stored analysis insights - ID: d1e1fafe-8259-4c4b-aabc-374ad19de98a
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Updating memory profile for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_longterm_memory?select=id&user_id=eq.%2735pDPUIfAoRl2Y700bFkxPKYjj "HTTP/2 200 OK"
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_longterm_memory "HTTP/2 201 Created"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_meta_memory?select=id&user_id=eq.%273 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_meta_memory "HTTP/2 201 Created"
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Memory profile updated for 35pDPUIfAoRl2Y700bFkxPKYjjf2
‚úÖ [SHARED_ANALYSIS] Fresh behavior analysis completed for 35pDPUIf        
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Cleanup completed   
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Service cleaned up
INFO:services.api_gateway.openai_main:[SHARED_ANALYSIS] 35pDPUIf... Fresh analysis completed
‚úÖ [ROUTINE_GENERATE] Got shared behavior analysis (shared)
   ‚Ä¢ Analysis source: Shared behavior analysis service
   ‚Ä¢ Eliminates duplicate OpenAI calls
INFO:services.health_data_client:[API_CLIENT] Initialized for https://hos-fapi-hm-sahha.onrender.com
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Connected to Supabase directly
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=last_analysis_at&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Last analysis for 35pDPUIfAoRl2Y700bFkxPKYjjf2: 2025-08-15T19:41:08.895934+00:00
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Time since last analysis: 0.0 hours
INFO:services.user_data_service:[ANALYSIS_DATA] Incremental analysis for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:services.user_data_service:[ANALYSIS_DATA] Last analysis: 0.0 hours ago at 2025-08-15T19:41:08.895934+00:00
INFO:services.user_data_service:[ANALYSIS_DATA] Fetching incremental data from 2025-08-15T19:41:08.895934+00:00 to now
üìä INCREMENTAL_SYNC: Last analysis was 0.0 hours ago
üìä INCREMENTAL_SYNC: Fetching new data since 2025-08-15 19:41
INFO:httpx:HTTP Request: PATCH https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Updated analysis time for 35pDPUIfAoRl2Y700bFkxPKYjjf2: 2025-08-15T19:41:52.690280+00:00       
INFO:services.user_data_service:[ANALYSIS_DATA] Updated last_analysis_at to: 2025-08-15T19:41:52.690280+00:00
[üîç] Attempting Supabase connection...
[üîç] URL: https://ijcckqnqruwvqqbkiubb.s...
[üîç] Key: Present
[‚úÖ] Connected to Supabase successfully - client type: <class 'supabase._sync.client.SyncClient'>
INFO:services.user_data_service:[INCREMENTAL] Fetching data for 35pDPUIfAoRl2Y700bFkxPKYjjf2 since 2025-08-15T19:41:08.895934+00:00
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/scores?select=%2A&profile_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&created_at=gte.2025-08-15T19%3A41%3A08.895934%2B00%3A00&order=created_at.desc&limit=1000 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/biomarkers?select=%2A&profile_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&created_at=gte.2025-08-15T19%3A41%3A08.895934%2B00%3A00&order=created_at.desc&limit=1000 "HTTP/2 200 OK"
INFO:services.user_data_service:[INCREMENTAL] Using Supabase native API
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/archetypes?select=id%2Cprofile_id%2Cname%2Cperiodicity%2Cvalue%2Cdata%2Cstart_date_time%2Cend_date_time%2Ccreated_at%2Cupdated_at&profile_id=eq.%2735pDPUIfAoRl2Y700 "HTTP/2 200 OK"
üìä INCREMENTAL_RESULT: 0 scores, 0 biomarkers
‚è∞ TIME_SPAN: 0.0 hours of new data
üìÖ LATEST_DATA: 08/15 19:41
‚ö†Ô∏è  ANALYSIS_DATA: No new data since last analysis - checking for stale timmestamp
[ERROR] Query fetch failed: Invalid non-printable ASCII character in URL, '\n' at position 7.
[DEBUG] Original Query:
                        SELECT GREATEST(
                            COALESCE(MAX(scores.created_at), '1970-01-01'::timestamp),
                            COALESCE(MAX(biomarkers.created_at), '1970-01-01'::timestamp)
                        ) as latest_timestamp
                        FROM scores
                        FULL OUTER JOIN biomarkers ON scores.profile_id = biomarkers.profile_id
                        WHERE scores.profile_id = $1 OR biomarkers.profile_id = $1

[DEBUG] Query Args: ('35pDPUIfAoRl2Y700bFkxPKYjjf2',)
[DEBUG] Parsed Operation: SELECT
[DEBUG] Target Table: scores
                        FULL OUTER
[DEBUG] Processed Query: SELECT GREATEST(
                            COALESCE(MAX(scores.created_at), '1970-01-01'::timestamp),
                            COALESCE(MAX(biomarkers.created_at), '1970-01-01'::timestamp)
                        ) as latest_timestamp
                        FROM scores
                        FULL OUTER JOIN biomarkers ON scores.profile_id = biomarkers.profile_id
                        WHERE scores.profile_id = '35pDPUIfAoRl2Y700bFkxPKYjjf2' OR biomarkers.profile_id = '35pDPUIfAoRl2Y700bFkxPKYjjf2'
[DEBUG] WHERE Conditions: [{'column': 'scores.profile_id', 'operator': 'eq', 'value': "'35pDPUIfAoRl2Y700bFkxPKYjjf2' O"}]
ERROR:services.user_data_service:[STALE_CHECK] Failed to get actual latest timestamp: Invalid non-printable ASCII character in URL, '\n' at position 7.
‚úÖ ANALYSIS_DATA: No new data since last analysis - up to date
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=analysis_metadata&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: PATCH https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Incremented analysis count for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:services.user_data_service:[ANALYSIS_DATA] Incremental analysis completed in 4.57s
INFO:services.user_data_service:[ANALYSIS_DATA] Fetched 0 scores, 0 biomarkers
INFO:services.user_data_service:[ANALYSIS_DATA] Latest data timestamp: 2025-08-15T19:41:08.895934+00:00
üèÉ‚Äç‚ôÇÔ∏è [MEMORY_ENHANCED] Starting memory-enhanced routine generation for 35p pDPUIf...
üìã [MEMORY_ENHANCED] Preparing memory context for routine generation...    
[üîÑ MEMORY_SERVICE] Creating new adapter and connecting...
[üîç] Attempting Supabase connection...
[üîç] URL: https://ijcckqnqruwvqqbkiubb.s...
[üîç] Key: Present
[‚úÖ] Connected to Supabase successfully - client type: <class 'supabase._sync.client.SyncClient'>
[‚úÖ MEMORY_SERVICE] Connected to Supabase successfully
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_analysis_results?select=id%2Cuser_id%2Canalysis_type%2Canalysis_result%2Carchetype%2Ccreated_at&user_id=eq.%2735pDPUIfAoRl2Y700&order=created_at.asc "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Connected to Supabase directly
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=last_analysis_at&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Last analysis for 35pDPUIfAoRl2Y700bFkxPKYjjf2: 2025-08-15T19:41:52.690280+00:00
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Time since last analysis: 0.0 hours
üìä PROFILE_CHECK: Found last_analysis_at = 2025-08-15T19:41:52.690280+00:00
‚úÖ ANALYSIS_MODE: Using profiles table (analysis_results empty)
‚è±Ô∏è ANALYSIS_MODE: Last analysis was 0.1 minutes ago (0.0 hours, 0 days) froom profiles
üîÑ ANALYSIS_MODE: Previous analysis found - this is a FOLLOW-UP analysis (incremental data + memory)
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_longterm_memory?select=user_id%2Cmemory_category%2Cmemory_data%2Cconfidence_score%2Ccreated_at%2Clast_updated&user_id=eq.%2735pDPUIfAoRl2Y700&order=confidence_score.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_shortterm_memory?select=user_id%2Cmemory_category%2Ccontent%2Cconfidence_score%2Ccreated_at%2Cexpires_at&user_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&order=created_at.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_meta_memory?select=adaptation_patterns%2Clearning_velocity%2Csuccess_predictors%2Cfailure_patterns%2Cagent_effectiveness%2Cconfidence_level%2Clast_updated&user_id=eq.%2735pDPUIfAoRl2Y700&order=confidence_level.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_analysis_results?select=id%2Cuser_id%2Canalysis_type%2Canalysis_result%2Carchetype%2Ccreated_at&user_id=eq.%2735pDPUIfAoRl2Y700&order=created_at.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_working_memory "HTTP/2 201 Created"
üìã MEMORY_CONTEXT: follow_up mode, 1 days, 4 focus areas
INFO:services.health_data_client:[API_CLIENT] Initialized for https://hos-fapi-hm-sahha.onrender.com
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Connected to Supabase directly
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=last_analysis_at&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Last analysis for 35pDPUIfAoRl2Y700bFkxPKYjjf2: 2025-08-15T19:41:52.690280+00:00
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Time since last analysis: 0.0 hours
INFO:services.user_data_service:[ANALYSIS_DATA] Incremental analysis for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:services.user_data_service:[ANALYSIS_DATA] Last analysis: 0.0 hours ago at 2025-08-15T19:41:52.690280+00:00
INFO:services.user_data_service:[ANALYSIS_DATA] Fetching incremental data from 2025-08-15T19:41:52.690280+00:00 to now
üìä INCREMENTAL_SYNC: Last analysis was 0.0 hours ago
üìä INCREMENTAL_SYNC: Fetching new data since 2025-08-15 19:41
INFO:httpx:HTTP Request: PATCH https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Updated analysis time for 35pDPUIfAoRl2Y700bFkxPKYjjf2: 2025-08-15T19:42:01.084334+00:00       
INFO:services.user_data_service:[ANALYSIS_DATA] Updated last_analysis_at to: 2025-08-15T19:42:01.084334+00:00
[üîç] Attempting Supabase connection...
[üîç] URL: https://ijcckqnqruwvqqbkiubb.s...
[üîç] Key: Present
[‚úÖ] Connected to Supabase successfully - client type: <class 'supabase._sync.client.SyncClient'>
INFO:services.user_data_service:[INCREMENTAL] Fetching data for 35pDPUIfAoRl2Y700bFkxPKYjjf2 since 2025-08-15T19:41:52.690280+00:00
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/scores?select=%2A&profile_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&created_at=gte.2025-08-15T19%3A41%3A52.690280%2B00%3A00&order=created_at.desc&limit=1000 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/biomarkers?select=%2A&profile_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&created_at=gte.2025-08-15T19%3A41%3A52.690280%2B00%3A00&order=created_at.desc&limit=1000 "HTTP/2 200 OK"
INFO:services.user_data_service:[INCREMENTAL] Using Supabase native API
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/archetypes?select=id%2Cprofile_id%2Cname%2Cperiodicity%2Cvalue%2Cdata%2Cstart_date_time%2Cend_date_time%2Ccreated_at%2Cupdated_at&profile_id=eq.%2735pDPUIfAoRl2Y700 "HTTP/2 200 OK"
üìä INCREMENTAL_RESULT: 0 scores, 0 biomarkers
‚è∞ TIME_SPAN: 0.0 hours of new data
üìÖ LATEST_DATA: 08/15 19:41
‚ö†Ô∏è  ANALYSIS_DATA: No new data since last analysis - checking for stale timmestamp
[ERROR] Query fetch failed: Invalid non-printable ASCII character in URL, '\n' at position 7.
[DEBUG] Original Query:
                        SELECT GREATEST(
                            COALESCE(MAX(scores.created_at), '1970-01-01'::timestamp),
                            COALESCE(MAX(biomarkers.created_at), '1970-01-01'::timestamp)
                        ) as latest_timestamp
                        FROM scores
                        FULL OUTER JOIN biomarkers ON scores.profile_id = biomarkers.profile_id
                        WHERE scores.profile_id = $1 OR biomarkers.profile_id = $1

[DEBUG] Query Args: ('35pDPUIfAoRl2Y700bFkxPKYjjf2',)
[DEBUG] Parsed Operation: SELECT
[DEBUG] Target Table: scores
                        FULL OUTER
[DEBUG] Processed Query: SELECT GREATEST(
                            COALESCE(MAX(scores.created_at), '1970-01-01'::timestamp),
                            COALESCE(MAX(biomarkers.created_at), '1970-01-01'::timestamp)
                        ) as latest_timestamp
                        FROM scores
                        FULL OUTER JOIN biomarkers ON scores.profile_id = biomarkers.profile_id
                        WHERE scores.profile_id = '35pDPUIfAoRl2Y700bFkxPKYjjf2' OR biomarkers.profile_id = '35pDPUIfAoRl2Y700bFkxPKYjjf2'
[DEBUG] WHERE Conditions: [{'column': 'scores.profile_id', 'operator': 'eq', 'value': "'35pDPUIfAoRl2Y700bFkxPKYjjf2' O"}]
ERROR:services.user_data_service:[STALE_CHECK] Failed to get actual latest timestamp: Invalid non-printable ASCII character in URL, '\n' at position 7.
‚úÖ ANALYSIS_DATA: No new data since last analysis - up to date
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?select=analysis_metadata&id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:httpx:HTTP Request: PATCH https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/profiles?id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
INFO:services.simple_analysis_tracker:[SIMPLE_TRACKER] Incremented analysis count for 35pDPUIfAoRl2Y700bFkxPKYjjf2
INFO:services.user_data_service:[ANALYSIS_DATA] Incremental analysis completed in 4.60s
INFO:services.user_data_service:[ANALYSIS_DATA] Fetched 0 scores, 0 biomarkers
INFO:services.user_data_service:[ANALYSIS_DATA] Latest data timestamp: 2025-08-15T19:41:52.690280+00:00
üóìÔ∏è [MEMORY_ENHANCED] Using 1 days of data for routine (mode: follow_up)    
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_longterm_memory?select=user_id%2Cmemory_category%2Cmemory_data%2Cconfidence_score%2Ccreated_at%2Clast_updated&user_id=eq.%2735pDPUIfAoRl2Y700&order=confidence_score.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_shortterm_memory?select=user_id%2Cmemory_category%2Ccontent%2Cconfidence_score%2Ccreated_at%2Cexpires_at&user_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2&order=created_at.asc "HTTP/2 200 OK"
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_meta_memory?select=adaptation_patterns%2Clearning_velocity%2Csuccess_predictors%2Cfailure_patterns%2Cagent_effectiveness%2Cconfidence_level%2Clast_updated&user_id=eq.%2735pDPUIfAoRl2Y700&order=confidence_level.asc "HTTP/2 200 OK"
üß† MEMORY_ENHANCED: Prompt enhanced with 2 memory elements
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Enhanced routine_plan prompt for 35pDPUIfAoRl2Y700bFkxPKYjjf2
üß† [MEMORY_ENHANCED] Enhanced routine prompt with memory context (+4912 chars)
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
üíæ [MEMORY_ENHANCED] Storing routine plan insights in memory...
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Storing insights from routine_plan analysis for 35pDPUIfAoRl2Y700bFkxPKYjjf2
üîç MEMORY DEBUG: Starting store_analysis_result for routine_plan
üîç MEMORY DEBUG: DB connection established: <class 'shared_libs.supabase_client.adapter.SupabaseAsyncPGAdapter'>
üîç MEMORY DEBUG: Executing SQL insert...
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_analysis_results "HTTP/2 201 Created"
üîç MEMORY DEBUG: SQL result: {'id': '215751f2-b8e8-4f45-b702-6177cf8f219c', 'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'analysis_type': 'routine_plan', 'archetype': 'Foundation Builder', 'analysis_result': {'date': '2025-08-15', 'system': 'HolisticOS', 'content': "**Daily Routine Plan for Foundation Builder**\n\n**Daily Summary:**\nToday's routine focuses on maintaining strong sleep quality while progressively increasing light-to-moderate physical activity. The key goals are to maintain Sleep Metrics ‚â• 0.80, increase Activity Metrics from 0.54 to ‚â• 0.65, and improve Mental Wellbeing Metrics from 0.74 to ‚â• 0.80. The plan leverages your solid sleep foundation to introduce a structured yet flexible approach to daytime movement and stress management.\n\n**Time Blocks:**\n\n1. **Morning Wake-up (6:00-7:00 AM): Foundation Setting and Energy Building**\n   - **Tasks:**\n     - **6:00-6:15 AM:** Gentle stretching routine (5-10 minutes)\n       - *Why it matters:* Helps to wake up your body gradually, improves flexibility, and sets a positive tone for the day.\n       - *Connection to insights:* Enhances readiness without compromising recovery, aligning with your body's current capacity.\n     - **6:15-6:30 AM:** Hydrate with a glass of water and a light breakfast\n       - *Why it matters:* Replenishes fluids lost overnight and provides energy for the morning.\n     - **6:30-7:00 AM:** Mindful breathing or meditation (5 minutes) followed by planning your day\n       - *Why it matters:* Reduces stress, enhances focus, and prepares your mind for the day's activities.\n       - *Connection to insights:* Supports mental wellbeing by integrating a moment of calm into your routine.\n\n2. **Focus Block (9:00-11:00 AM): Peak Productivity Window**\n   - **Tasks:**\n     - **9:00-9:30 AM:** Prioritize and tackle the most important task of the day\n       - *Why it matters:* Capitalizes on your peak cognitive function to efficiently handle demanding tasks.\n     - **9:30-10:00 AM:** Short break with light movement (e.g., standing desk or short walk)\n       - *Why it matters:* Keeps energy levels high and prevents fatigue.\n       - *Connection to insights:* Incrementally raises daytime movement, contributing to Activity Metrics improvement.\n     - **10:00-11:00 AM:** Continue with focused work or learning\n       - *Why it matters:* Maintains productivity and allows for deep work.\n\n3. **Afternoon Recharge (3:00-3:30 PM): Energy Restoration and Movement**\n   - **Tasks:**\n     - **3:00-3:15 PM:** Brisk walk or light physical activity (15 minutes)\n       - *Why it matters:* Boosts energy and mood, aids in meeting activity goals.\n       - *Connection to insights:* Anchors the habit of post-lunch walks, progressively increasing activity levels.\n     - **3:15-3:30 PM:** Hydrate and have a healthy snack\n       - *Why it matters:* Replenishes energy and prevents afternoon slump.\n\n4. **Evening Wind-down (8:30-9:30 PM): Recovery and Preparation for Rest**\n   - **Tasks:**\n     - **8:30-8:45 PM:** Set a fixed ‚Äòtech-off‚Äô time and engage in a calming activity (e.g., reading or journaling)\n       - *Why it matters:* Prepares your mind for sleep, protecting sleep latency.\n       - *Connection to insights:* Preserves existing sleep strength and supports mental wellbeing.\n     - **8:45-9:00 PM:** Reflect on the day with a 5-minute mood rating and note one positive action\n       - *Why it matters:* Reinforces positive habits and tracks mental wellbeing.\n     - **9:00-9:30 PM:** Prepare for bed, maintaining a consistent bedtime routine\n       - *Why it matters:* Ensures quality sleep by sticking to a regular schedule.\n\n**Health Data Integration:**\n- **Sleep Metrics (‚â• 0.80):** Continue capturing sleep data daily to maintain this strong habit.\n- **Activity Metrics (0.54 ‚Üí ‚â• 0.65):** Incremental increases in daily movement through structured walks and light activities.\n- **Mental Wellbeing Metrics (0.74 ‚Üí ‚â• 0.80):** Evening reflection and mindful practices support this improvement.\n\nThis routine is designed to be practical and supportive, aligning with your preferences for a moderate pace of change and a supportive communication style. By focusing on simple, achievable steps, it aims to build confidence and establish foundational habits that contribute to long-term health optimization.", 'archetype': 'Foundation Builder', 'plan_type': 'comprehensive_routine', 'model_used': 'gpt-4o'}, 'input_summary': {'source': 'memory_service', 'data_quality': 'excellent'}, 'agent_id': 'memory_service', 'analysis_version': '1.0', 'system_prompt_version': None, 'confidence_score': 0, 'completeness_score': 0, 'processing_time_ms': None, 'created_at': '2025-08-15T19:42:38.092145+00:00', 'analysis_date': '2025-08-15', 'user_rating': None, 'user_feedback': None, 'implementation_success': None, 'follow_up_date': None, 'analysis_hash': 'a5e13dc2cafe8068057ad1d2232a401c', 'data_source_hash': None, 'is_duplicate': False, 'original_analysis_id': None}
üìä MEMORY: Stored routine_plan analysis for user 35pDPUIf... ID: 215751f2-b8e8-4f45-b702-6177cf8f219c
üîç [DEBUG] About to insert insight with params:
   user_id: 35pDPUIfAoRl2Y700bFkxPKYjjf2
   insight_type: routine
   title: Routine Plan Focus...
   content: **Daily Routine Plan for Foundation Builder**

**Daily Summary:**
Today's routine focuses on maintai...
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_insights "HTTP/2 201 Created"
üîç [DEBUG] INSERT result: {'id': '9bccbb7e-1328-49c9-be24-5d42ff1e394a', 'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'insight_type': 'routine', 'source_analysis_id': None, 'source_analysis_type': None, 'archetype': 'Foundation Builder', 'insight_title': 'Routine Plan Focus', 'insight_content': "**Daily Routine Plan for Foundation Builder**\n\n**Daily Summary:**\nToday's routine focuses on maintaining strong sleep quality while progressively increasing light-to-moderate physical activity. The key goals are to maintain Sleep Metrics ‚â• 0.80, increase Activity Metrics from 0.54 to ‚â• 0.65, and improve Mental Wellbeing Metrics from 0.74 to ‚â• 0.80. The plan leverages your solid sleep foundation to...", 'priority': 5, 'actionability_score': 0.7, 'data_context': None, 'confidence_score': 0.8, 'supporting_metrics': None, 'tags': [], 'is_active': True, 'user_acknowledged': False, 'user_rating': None, 'user_feedback': None, 'created_at': '2025-08-15T19:42:38.456987+00:00', 'updated_at': '2025-08-15T19:42:38.456987+00:00', 'expires_at': '2025-08-22T19:42:38.056888+00:00', 'last_surfaced_at': None, 'content_hash': '61492f46f13b7f19aa25a2512aaf13f8', 'context_signature': '61492f46f13b7f19aa25a2512aaf13f8'}
‚ú® [INSIGHTS] Stored insight: Routine Plan Focus
INFO:services.insights_extraction_service:Extracted and stored 1 insights from routine_plan
‚ú® INSIGHTS: Stored 1 insights from routine_plan
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_shortterm_memory "HTTP/2 201 Created"
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Stored analysis insights - ID: 215751f2-b8e8-4f45-b702-6177cf8f219c
‚úÖ [MEMORY_ENHANCED] Routine plan insights stored successfully
üíæ [MEMORY_ENHANCED] Storing complete routine plan in database...
üîç MEMORY DEBUG: Starting store_analysis_result for routine_plan
[üîÑ MEMORY_SERVICE] Creating new adapter and connecting...
[üîç] Attempting Supabase connection...
[üîç] URL: https://ijcckqnqruwvqqbkiubb.s...
[üîç] Key: Present
[‚úÖ] Connected to Supabase successfully - client type: <class 'supabase._sync.client.SyncClient'>
[‚úÖ MEMORY_SERVICE] Connected to Supabase successfully
üîç MEMORY DEBUG: DB connection established: <class 'shared_libs.supabase_client.adapter.SupabaseAsyncPGAdapter'>
üîç MEMORY DEBUG: Executing SQL insert...
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_analysis_results "HTTP/2 409 Conflict"
[ERROR] INSERT RETURNING failed: {'message': 'duplicate key value violates unique constraint "unique_user_type_date"', 'code': '23505', 'hint': None, 'details': None}
[‚ùå] Query fetchrow failed: {'message': 'duplicate key value violates unique constraint "unique_user_type_date"', 'code': '23505', 'hint': None, 'details': None}
üîç MEMORY DEBUG: SQL insert failed with error: {'message': 'duplicate key value violates unique constraint "unique_user_type_date"', 'code': '23505', 'hint': None, 'details': None}
üîç MEMORY DEBUG: Insert error type: <class 'postgrest.exceptions.APIError'>
‚úÖ [MEMORY_ENHANCED] Complete routine plan stored with ID: None
üìù Analysis logged: logs/input_1.txt, logs/output_1.txt
üìù [MEMORY_ENHANCED] Complete standalone analysis logged to files 1        
INFO:services.memory_integration_service:[MEMORY_INTEGRATION] Service cleaned up
‚úÖ [MEMORY_ENHANCED] Memory-enhanced routine generation completed for 35pDPUIf
INFO:     127.0.0.1:62335 - "POST /api/user/35pDPUIfAoRl2Y700bFkxPKYjjf2/routine/generate HTTP/1.1" 200 OK
üîç [DEBUG] About to insert insight with params:
   user_id: 35pDPUIfAoRl2Y700bFkxPKYjjf2
   insight_type: general
   title: Sample Health Insight...
   content: This is a sample insight for Foundation Builder archetype. Focus on maintaining consistent daily rou...
INFO:httpx:HTTP Request: POST https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_insights "HTTP/2 201 Created"
üîç [DEBUG] INSERT result: {'id': '6942ba05-0a64-415a-9253-c06be5e684e1', 'user_id': '35pDPUIfAoRl2Y700bFkxPKYjjf2', 'insight_type': 'general', 'source_analysis_id': None, 'source_analysis_type': None, 'archetype': 'Foundation Builder', 'insight_title': 'Sample Health Insight', 'insight_content': 'This is a sample insight for Foundation Builder archetype. Focus on maintaining consistent daily routines for better health outcomes.', 'priority': 5, 'actionability_score': 0.7, 'data_context': None, 'confidence_score': 0.8, 'supporting_metrics': None, 'tags': [], 'is_active': True, 'user_acknowledged': False, 'user_rating': None, 'user_feedback': None, 'created_at': '2025-08-15T19:42:40.143371+00:00', 'updated_at': '2025-08-15T19:42:40.143371+00:00', 'expires_at': '2025-08-22T19:42:39.955387+00:00', 'last_surfaced_at': None, 'content_hash': 'f92c5b199d99f26c51e663a2fb1358ac', 'context_signature': 'f92c5b199d99f26c51e663a2fb1358ac'}
‚ú® [INSIGHTS] Stored insight: Sample Health Insight
INFO:services.api_gateway.insights_endpoints:Generated 1 fresh sample insight
INFO:httpx:HTTP Request: GET https://ijcckqnqruwvqqbkiubb.supabase.co/rest/v1/holistic_insights?select=%2A&user_id=eq.35pDPUIfAoRl2Y700bFkxPKYjjf2 "HTTP/2 200 OK"
üìù [INSIGHTS_LOGGER] Added 6 insights to output_2.txt
üìù [INSIGHTS_LOGGER] Created dedicated insights log: insights_2.txt        
‚úÖ [INSIGHTS_LOGGER] Successfully logged 6 insights (Analysis #2)
   üìÑ Added to: logs/output_2.txt
   üìã Created: logs/insights_2.txt
INFO:services.api_gateway.insights_endpoints:Insights logged: {'analysis_number': 2, 'output_file_success': True, 'dedicated_file_success': True, 'insights_count': 6}
INFO:     127.0.0.1:62442 - "POST /api/v1/insights/generate HTTP/1.1" 200 OK
